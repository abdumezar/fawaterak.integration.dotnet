@Fawaterak_HostAddress = http://localhost:5152
@contentType = application/json

### Get payment methods
GET {{Fawaterak_HostAddress}}/api/fawaterak/payment-methods
Accept: application/json

### Create invoice link
# Note: paymentMethodId is optional for invoice link creation
POST {{Fawaterak_HostAddress}}/api/fawaterak/invoices
Content-Type: {{contentType}}
Accept: application/json

{
  "customer": {
    "customer_unique_id": "cust-001",
    "firstName": "John",
    "lastName": "Doe",
    "email": "john.doe@example.com",
    "address": "1 Main St",
    "phone": "+201234567890"
  },
  "cartItems": [
    { "name": "Item A", "price": 100.00, "quantity": 1 },
    { "name": "Item B", "price": 50.50, "quantity": 2 }
  ],
  "currency": "EGP",
  "frequency": "once",
  "discountData": { "type": "pcg", "value": 10 },
  "taxData": { "title": "VAT", "value": 5 },
  "payLoad": { "OrderId": "ORD-1001", "CartId": "CART-2002" },
  "dueDate": "2025-12-31T00:00:00Z",
  "redirectionUrls": {
    {
      "successUrl": "https://example.com/payments/success",
      "failUrl": "https://example.com/payments/failure",
      "pendingUrl": "https://example.com/payments/pending"
    }
  }
}

### Init payment (GeneralPay)
# Important: paymentMethodId is REQUIRED here and should be a valid provider method id.
# First, call the payment-methods endpoint to discover available methods and their provider PaymentId.
POST {{Fawaterak_HostAddress}}/api/fawaterak/pay
Content-Type: {{contentType}}
Accept: application/json

{
  "paymentMethodId": 1,
  "customer": {
    "customer_unique_id": "cust-001",
    "firstName": "John",
    "lastName": "Doe",
    "email": "john..doe@example.com",
    "address": "1 Main St",
    "phone": "+201234567890"
  },
  "cartItems": [
    { "name": "Item A", "price": 100.00, "quantity": 1 },
    { "name": "Item B", "price": 50.50, "quantity": 2 }
  ],
  "currency": "EGP",
  "frequency": "once",
  "payLoad": { "OrderId": "ORD-1001", "CartId": "CART-2002" },
  "dueDate": "2025-12-31T00:00:00Z",
  "redirectionUrls": {
    {
      "successUrl": "https://example.com/payments/success",
      "failUrl": "https://example.com/payments/failure",
      "pendingUrl": "https://example.com/payments/pending"
    }
  }
}

### Generate IFrame hash
# Replace YOUR_DOMAIN with your actual domain (e.g., example.com)
GET {{Fawaterak_HostAddress}}/api/fawaterak/iframe-hash?domain=YOUR_DOMAIN
Accept: application/json

### Webhook: paid_json (from Fawaterak to your endpoint)
# The HashKey should be generated by: HMACSHA256(ApiKey, "InvoiceId={invoice_id}&InvoiceKey={invoice_key}&PaymentMethod={payment_method}")
POST {{Fawaterak_HostAddress}}/api/fawaterak/webhook-paid_json
Content-Type: {{contentType}}
Accept: application/json

{
  "invoice_id": 123456789,
  "invoice_key": "INV-KEY-ABC",
  "hashKey": "put-computed-hash-here",
  "payment_method": "Card",
  "invoice_status": "paid",
  "pay_load": "{ \"OrderId\": \"ORD-1001\", \"CartId\": \"CART-2002\" }"
}

### Webhook: cancel
# HashKey = HMACSHA256(ApiKey, "referenceId={referenceId}&PaymentMethod={paymentMethod}")
POST {{Fawaterak_HostAddress}}/api/fawaterak/webhook-cancel
Content-Type: {{contentType}}
Accept: application/json

{
  "hashKey": "put-computed-hash-here",
  "referenceId": "REF-1234",
  "status": "canceled",
  "paymentMethod": "Card",
  "pay_load": { "OrderId": "ORD-1001", "CartId": "CART-2002" }
}

### Webhook: failed
POST {{Fawaterak_HostAddress}}/api/fawaterak/webhook-failed
Content-Type: {{contentType}}
Accept: application/json

{
  "hashKey": "put-computed-hash-here",
  "referenceId": "REF-9999",
  "status": "failed",
  "paymentMethod": "Card",
  "pay_load": { "OrderId": "ORD-1001", "CartId": "CART-2002" }
}
